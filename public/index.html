<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- desktop view on all screen sizes -->
    <meta name="viewport" content="width=device-width, initial-scale=0.1">
    <title>Air Quality Monitor Dashboard</title>

    <script defer src="/__/firebase/9.8.4/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/9.8.4/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
    th {
        color: #000000;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        padding-top: 100px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

    .modal-header {
        padding: 2px 16px;
        background-color: #23408e;
        color: white;
    }

    .close {
        color: white;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    body {
        background-image: url(https://img.freepik.com/premium-vector/background-white-elegant-texture_23-2148438404.jpg?w=2000);
    }

    canvas {
        max-height: 700px;
    }

    select {
        margin-bottom: 15px;
    }
</style>

<body>
<div class="container">
    <div class="row" style="text-align: center; padding: 30px 0;">
        <div class="col-md-3"></div>
        <div class="col-md-3">
            <h3 id="currentDate"></h3>
        </div>
        <div class="col-md-3">
            <h3 id="currentTime"></h3>
        </div>
        <div class="col-md-3"></div>
    </div>

    <!-- hidden firebase (temperature) date drop-down menu (used for timed refresh array purposes only) -->
    <select hidden id="firebaseDateArray"></select>

    <!-- modal for temperature dashboard -->
    <div id="temperatureModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Temperature Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <!-- temperature date drop-down menu -->
                <label for="temperatureDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="temperatureDateArray"
                        onchange="selectTemperatureOption()"></select>
                <!-- temperature data chart -->
                <div id="temperatureChartContainer">
                    <canvas id="temperatureChart"></canvas>
                </div>
                <span style="color: #00AEEF">< 23&#8451: Low Temperature &#129398;</span>
                <br>
                <span style="color: #4CBB17">23&#8451 - 26&#8451: Recommended Indoor Temperature &#128516; (Department of Standards Malaysia)</span>
                <br>
                <span style="color: #bd1816">> 26&#8451: High Temperature &#129397;</span>
                <br>
                <a href="http://www.mgbc.org.my/Downloads/08052018_MUIGBC2018_E-PROCEEDING_PAPER/20180508_3_Indoor_and_Outdoor_Environmental_Quality/8_Assessment_of_Indoor_Air_Temperature_of_a_Low_Cost_Single_Story_Detached_House.pdf">
                <span style="float: right">
                    Department of Standards Malaysia &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for humidity dashboard-->
    <div id="humidityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Humidity Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="humidityDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="humidityDateArray"
                        onchange="selectHumidityOption()"></select>
                <div id="humidityChartContainer">
                    <canvas id="humidityChart"></canvas>
                </div>
                <span style="color: #4CBB17">0% - 59%: Low Risk of Mold Growth &#128516;</span>
                <br>
                <span style="color: #FFA500">60% - 79%: Risk of Mold Growth &#128577;</span>
                <br>
                <span style="color: #bd1816">80% - 100%: High Risk of Mold Growth &#128543;</span>
                <br>
                <a href="https://indoorscience.com/blog/relative-humidity-and-mold/">
                <span style="float: right">
                    IndoorScience &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for alcohol dashboard-->
    <div id="alcoholModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Alcohol Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="alcoholDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="alcoholDateArray"
                        onchange="selectAlcoholOption()"></select>
                <div id="alcoholChartContainer">
                    <canvas id="alcoholChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 100ppm: Safe Levels of Alcohol &#128516;</span>
                <br>
                <span style="color: #FFA500">> 100ppm - 200ppm: Permissible Levels of Alcohol &#128577; (ACGIH TLV - 8 Hours = 200ppm)</span>
                <br>
                <span style="color: #bd1816">> 200ppm - 400ppm: Alarming Levels of Alcohol &#128567; (ACGIH TLV - 15 Minutes = 400ppm)</span>
                <br>
                <span style="color: #000000">> 400ppm: Hazardous Levels of Alcohol &#128128;</span>
                <br>
                <a href="https://www.chemtronics.com/Content/Images/uploaded/documents/CW8300_United%20States%20(US)%20SDS%20HCS%202012_English%20(US).pdf">
                <span style="float: right">
                    Chemtronics &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for acetone dashboard-->
    <div id="acetoneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acetone Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="acetoneDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="acetoneDateArray"
                        onchange="selectAcetoneOption()"></select>
                <div id="acetoneChartContainer">
                    <canvas id="acetoneChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 100ppm: Safe Levels of Acetone &#128516;</span>
                <br>
                <span style="color: #FFA500">> 100ppm - 250ppm: Permissible Levels of Acetone &#128577; (ACGIH TLV - 8 Hours = 250ppm)</span>
                <br>
                <span style="color: #bd1816">> 250ppm - 500ppm: Alarming Levels of Acetone &#128567; (ACGIH TLV - 15 Minutes = 500ppm)</span>
                <br>
                <span style="color: #000000">> 500ppm: Hazardous Levels of Acetone &#128128;</span>
                <br>
                <a href="https://www.ccohs.ca/oshanswers/chemicals/chem_profiles/acetone.html">
                <span style="float: right">
                    Canadian Centre for Occupational Health and Safety &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for lpg dashboard-->
    <div id="LPGModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Liquefied Petroleum Gas Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="LPGDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="LPGDateArray" onchange="selectLPGOption()"></select>
                <div id="LPGChartContainer">
                    <canvas id="LPGChart"></canvas>
                </div>
                <span style="color: #4CBB17">0 - 500ppm: Safe Levels of LPG &#128516; </span>
                <br>
                <span style="color: #FFA500">> 500ppm - 1000ppm: Permissible Levels of LPG &#128577; (ACGIH TLV - 8 Hours = 1000ppm)</span>
                <br>
                <span style="color: #bd1816">> 1000ppm - 1250ppm: Alarming Levels of LPG &#128567;</span>
                <br>
                <span style="color: #000000">> 1250ppm: Hazardous Levels of LPG &#128128;</span>
                <br>
                <a href="https://www.cdc.gov/niosh/idlh/68476857.html">
                <span style="float: right">
                    The National Institute for Occupational Safety and Health &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for carbon monoxide dashboard-->
    <div id="COModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Carbon Monoxide Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="CODateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="CODateArray" onchange="selectCOOption()"></select>
                <div id="COChartContainer">
                    <canvas id="COChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 6ppm: Safe Levels of CO &#128516; (WHO 24 Hour Average = 6ppm)</span>
                <br>
                <span style="color: #FFA500">> 6ppm - 50ppm: Permissible Levels of CO &#128577; (OSHA PEL - 8 Hours = 50ppm)</span>
                <br>
                <span style="color: #bd1816">> 50ppm - 200ppm: Alarming Levels of CO &#128567; (NIOSH STEL - 15 Minutes = 200ppm)</span>
                <br>
                <span style="color: #000000">> 200 ppm: Hazardous Levels of CO &#128128;</span>
                <br>
                <a href="https://gaslab.com/blogs/articles/carbon-monoxide-levels-chart">
                <span style="float: right">
                    GasLab &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for pm2.5 particulate dashboard-->
    <div id="PM25Modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>PM2.5 Particulate Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="PM25DateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="PM25DateArray" onchange="selectPM25Option()"></select>
                <div id="PM25ChartContainer">
                    <canvas id="PM25Chart"></canvas>
                </div>
                <span style="color: #4CBB17">0μg/m<sup>3</sup> - 12μg/m<sup>3</sup>: Safe Levels of PM2.5 Particulate Matter &#128516; (EPA Annual PM2.5 Standard = 12μg/m<sup>3</sup>)</span>
                <br>
                <span style="color: #FFA500">> 12μg/m<sup>3</sup> - 35μg/m<sup>3</sup> = Permissible Levels of PM2.5 Particulate Matter &#128577; (EPA 24-Hour PM2.5 Standard = 35μg/m<sup>3</sup>)</span>
                <br>
                <span style="color: #bd1816">> 35μg/m<sup>3</sup> - 55μg/m<sup>3</sup> = Alarming Levels of PM2.5 Particulate Matter &#128567;</span>
                <br>
                <span style="color: #000000">> 55μg/m<sup>3</sup> = Hazardous Levels of PM2.5 Particulate Matter &#128128;</span>
                <br>
                <a href="https://www.epa.gov/sites/default/files/2016-04/documents/2012_aqi_factsheet.pdf">
                <span style="float: right">
                    Environmental Protection Agency &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <div class="row" style="justify-content: space-between;">
        <div id="temperatureIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 3%;">
            <h5 style="color: #fff;">Temperature &#127777;</h5>
            <h1 id="latestTemperature" style="color: #fff;"></h1>
        </div>
        <div id="humidityIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Humidity &#128167;</h5>
            <h1 id="latestHumidity" style="color: #fff;"></h1>
        </div>
        <div id="PM25Indicator" class="col-md-3" style="background-color:
        #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
        box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">PM2.5 Particulate&#128173;</h5>
            <h1 id="latestPM25" style="color: #fff;"></h1>
        </div>
    </div>

    <div class="row mt-5" style="justify-content: space-between;">
        <div id="alcoholIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Alcohol (C<sub>2</sub>H<sub>5</sub>OH)</h5>

            <h1 id="latestAlcohol" style="color: #fff;"></h1>
        </div>
        <div id="acetoneIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Acetone (C<sub>3</sub>H<sub>6</sub>O)</h5>
            <h1 id="latestAcetone" style="color: #fff;"></h1>
        </div>

        <div id="LPGIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Liquefied Petroleum Gas (C<sub>3</sub>H<sub>8</sub>)</h5>

            <h1 id="latestLPG" style="color: #fff;"></h1>
        </div>
    </div>

    <div class="row mt-5" style="justify-content: center;">
        <div id="COIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Carbon Monoxide (CO)</h5>
            <h1 id="latestCO" style="color: #fff;"></h1>
        </div>

    </div>
    <script>
        // reload page once again on page load to prevent chart.js loading glitches
        window.onload = function () {
            if (!window.location.hash) {
                window.location = window.location + '#loaded';
                window.location.reload();
            }
        }

        // dateArray.sort(compareDate) to sort date array from oldest to latest
        function compareDate(a, b) {
            const date1 = new Date(a)
            const date2 = new Date(b)
            return date1 - date2;
        }

        // convert array of strings to array of numbers
        function convertStringToNumberArray(stringArray, numberArray) {
            stringArray.forEach(str => {
                numberArray.push(Number(str));
            });
            return numberArray;
        }

        // findHighestInArray(array) to find highest value in array
        function findHighestInArray(array) {
            let highest = array[0];
            for (let i = 0; i < array.length; i++) {
                if (array[i] > highest) {
                    highest = array[i];
                }
            }
            return highest;
        }

        // findLowestInArray(array) to find lowest value in array
        function findLowestInArray(array) {
            let lowest = array[0];
            for (let i = 0; i < array.length; i++) {
                if (array[i] < lowest) {
                    lowest = array[i];
                }
            }
            return lowest;
        }

        function generateChart(parameterChartContainer, canvasChart, chartName, timeArray, parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling) {
            // empty and reload the div to prevent other parameter chart data from other days from being shown
            // when hovering over parameter chart data points
            document.getElementById(parameterChartContainer.toString()).innerHTML = "";
            document.getElementById(parameterChartContainer.toString()).innerHTML = canvasChart.toString();
            new Chart(chartName, {
                type: "line",
                data: {
                    labels: timeArray,
                    datasets: [{
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(0,0,255,1.0)",
                        borderColor: "rgba(0,0,255,0.1)",
                        data: parameterValueNumberArray

                    }]
                },
                options: {
                    legend: {display: false},
                    scales: {
                        yAxes: [{ticks: {min: lowestParameterCeiling, max: highestParameterCeiling}}],
                        // limit x axis to 24 ticks
                        xAxes: [{
                            ticks: {
                                display: true,
                                autoSkip: true,
                                maxTicksLimit: 24
                            }
                        }],
                    }
                }
            });
        }

        function selectParameterOption(parameterDateArray, sensorParameter) {
            // get selected parameter date
            let selectedParameterDate = document.getElementById(parameterDateArray.toString()).value;
            let selectedDayParameter = sensorParameter.toString() + selectedParameterDate;
            let timeArray = [];
            let parameterArray = [];
            let parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling;

            // retrieve firebase realtime database data of the selected parameter date
            firebase.database().ref(selectedDayParameter).on('value', (snap) => {
                let parameterStr = snap.val();
                let parameterValueArray = [];

                // insert retrieved selected parameter date data into array
                Object.keys(parameterStr).forEach((key) => {
                    parameterArray.push({[key]: parameterStr[key]});
                });

                let iterator = parameterArray.values();

                for (let elements of iterator) {
                    // insert selected parameter date data array element keys (time) into time array
                    timeArray.push(Object.keys(elements).toString());
                    // json converted to string for the selected parameter date data array element value (parameter)
                    let cleanParameter = JSON.stringify(Object.values(elements));
                    // remove unnecessary string data and be left with only actual parameter value
                    cleanParameter = cleanParameter.split(":").pop();
                    cleanParameter = cleanParameter.replaceAll("\"", "");
                    cleanParameter = cleanParameter.replaceAll("}", "");
                    cleanParameter = cleanParameter.replaceAll("]", "");
                    // insert actual parameter value into parameter value array
                    parameterValueArray.push(cleanParameter);
                }
                let yAxisValues = dynamicYAxis(parameterValueArray)
                parameterValueNumberArray = yAxisValues[0];
                lowestParameterCeiling = yAxisValues[1];
                highestParameterCeiling = yAxisValues[2];

            });
            return [timeArray, parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling];
        }

        function cleanParameterPush(parameterArray) {
            let iterator = parameterArray.values();
            let timeArray = [];
            let parameterValueArray = [];

            for (let elements of iterator) {
                // insert latest parameter array element keys (time) into time array
                timeArray.push(Object.keys(elements).toString());
                // json converted to string for the latest parameter array element value (temperature)
                let cleanParameter = JSON.stringify(Object.values(elements));
                // remove unnecessary string data and be left with only actual parameter value
                cleanParameter = cleanParameter.split(":").pop();
                cleanParameter = cleanParameter.replaceAll("\"", "");
                cleanParameter = cleanParameter.replaceAll("}", "");
                cleanParameter = cleanParameter.replaceAll("]", "");
                // insert actual parameter value into parameter value array
                parameterValueArray.push(cleanParameter);
            }

            return [timeArray, parameterValueArray];
        }

        function jsonLatestParameterReturnCompare(parameterStr) {
            let parameterArray = [];

            // insert retrieved latest parameter data into parameter array
            Object.keys(parameterStr).forEach((key) => {
                parameterArray.push({[key]: parameterStr[key]});
            });

            // json converted to string for final (latest) parameter array element value
            let latestParameter = parameterArray[parameterArray.length - 1];
            let parameterValue = Object.values(latestParameter);
            let jsonParameterValue = JSON.stringify(parameterValue);

            // remove unnecessary string data and be left with only actual latest parameter value
            jsonParameterValue = jsonParameterValue.split(":").pop();
            jsonParameterValue = jsonParameterValue.replaceAll("\"", "");
            jsonParameterValue = jsonParameterValue.replaceAll("}", "");
            jsonParameterValue = jsonParameterValue.replaceAll("]", "");

            return [parameterArray, latestParameter, jsonParameterValue];
        }

        function dynamicYAxis(parameterValueArray) {
            // dynamic chart y axis min max based on lowest and highest values
            let temporaryNumberArray = [];
            let parameterValueNumberArray = convertStringToNumberArray(parameterValueArray, temporaryNumberArray);
            let lowestParameter, highestParameter;
            lowestParameter = findLowestInArray(parameterValueNumberArray);
            highestParameter = findHighestInArray(parameterValueNumberArray);
            let lowestParameterCeiling = Math.round((Math.round(lowestParameter)) / 10) * 10;
            let highestParameterCeiling = Math.round((Math.round(highestParameter)) / 10) * 10;

            if (highestParameterCeiling === lowestParameterCeiling) {
                highestParameterCeiling = highestParameterCeiling + 10;
            }
            if (highestParameter > highestParameterCeiling) {
                while (highestParameter > highestParameterCeiling) {
                    highestParameterCeiling += 10;
                }
            }
            if (lowestParameter < lowestParameterCeiling) {
                while (lowestParameter < lowestParameterCeiling) {
                    lowestParameterCeiling -= 10;
                }
            }

            return [parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling];
        }

        async function RefDHT(DHTParameter, parameterDateSelect, parameterDateArray) {
            await firebase.database().ref(DHTParameter.toString()).once('value', (snap) => {
                let parameterDays = snap.val();
                parameterDays = Object.keys(parameterDays);
                // sort parameter date array from oldest to latest
                parameterDays.sort(compareDate);
                // load parameter date data into parameter date drop-down menu
                for (var i = 0; i < parameterDays.length; i++) {
                    var option = parameterDays[i];
                    var element = document.createElement("option");
                    element.textContent = option;
                    element.value = option;
                    parameterDateSelect.prepend(element);
                }
                // select latest parameter date by default
                document.getElementById(parameterDateArray.toString()).selectedIndex = "0";
            });
        }

        // obtain historical temperature data after selecting temperature date from drop-down menu
        function selectTemperatureOption() {
            let parameterArray = selectParameterOption("temperatureDateArray", 'DHT11/Temperature/');
            console.log(parameterArray);
            generateChart("temperatureChartContainer", "<canvas id=\"temperatureChart\"></canvas>", "temperatureChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectHumidityOption() {
            let parameterArray = selectParameterOption("humidityDateArray", 'DHT11/Humidity/');
            generateChart("humidityChartContainer", "<canvas id=\"humidityChart\"></canvas>", "humidityChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectAlcoholOption() {
            let parameterArray = selectParameterOption("alcoholDateArray", 'MQ135/Alcohol/');
            generateChart("alcoholChartContainer", "<canvas id=\"alcoholChart\"></canvas>", "alcoholChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectAcetoneOption() {
            let parameterArray = selectParameterOption("acetoneDateArray", 'MQ135/Acetone/');
            generateChart("acetoneChartContainer", "<canvas id=\"acetoneChart\"></canvas>", "acetoneChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectLPGOption() {
            let parameterArray = selectParameterOption("LPGateArray", 'MQ2/LPG/');
            generateChart("LPGChartContainer", "<canvas id=\"LPGChart\"></canvas>", "LPGChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectCOOption() {
            let parameterArray = selectParameterOption("CODateArray", 'MQ2/CO/');
            generateChart("COChartContainer", "<canvas id=\"COChart\"></canvas>", "COChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectPM25Option() {
            let parameterArray = selectParameterOption("PM25DateArray", 'DSM501A/PM25/');
            generateChart("PM25ChartContainer", "<canvas id=\"PM25Chart\"></canvas>", "PM25Chart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        document.addEventListener('DOMContentLoaded', async function () {
                var temperatureModal = document.getElementById("temperatureModal");
                var humidityModal = document.getElementById("humidityModal");
                var alcoholModal = document.getElementById("alcoholModal");
                var acetoneModal = document.getElementById("acetoneModal");
                var LPGModal = document.getElementById("LPGModal");
                var COModal = document.getElementById("COModal");
                var PM25Modal = document.getElementById("PM25Modal");

                var temperatureBtn = document.getElementById("temperatureIndicator");
                var humidityBtn = document.getElementById("humidityIndicator");
                var alcoholBtn = document.getElementById("alcoholIndicator");
                var acetoneBtn = document.getElementById("acetoneIndicator");
                var LPGBtn = document.getElementById("LPGIndicator");
                var COBtn = document.getElementById("COIndicator");
                var PM25Btn = document.getElementById("PM25Indicator");

                var span1 = document.getElementsByClassName("close")[0];
                var span2 = document.getElementsByClassName("close")[1];
                var span3 = document.getElementsByClassName("close")[2];
                var span4 = document.getElementsByClassName("close")[3];
                var span5 = document.getElementsByClassName("close")[4];
                var span6 = document.getElementsByClassName("close")[5];
                var span7 = document.getElementsByClassName("close")[6];


                // show modal after clicking data indicator
                temperatureBtn.onclick = function () {
                    temperatureModal.style.display = "block";
                }

                humidityBtn.onclick = function () {
                    humidityModal.style.display = "block";
                }

                alcoholBtn.onclick = function () {
                    alcoholModal.style.display = "block";
                }

                PM25Btn.onclick = function () {
                    PM25Modal.style.display = "block";
                }

                acetoneBtn.onclick = function () {
                    acetoneModal.style.display = "block";
                }

                LPGBtn.onclick = function () {
                    LPGModal.style.display = "block";
                }

                COBtn.onclick = function () {
                    COModal.style.display = "block";
                }

                // close modal after clicking "x" (close) modal button
                span1.onclick = function () {
                    temperatureModal.style.display = "none";
                }

                span2.onclick = function () {
                    humidityModal.style.display = "none";
                }

                span3.onclick = function () {
                    alcoholModal.style.display = "none";
                }

                span4.onclick = function () {
                    acetoneModal.style.display = "none";
                }

                span5.onclick = function () {
                    LPGModal.style.display = "none";
                }

                span6.onclick = function () {
                    COModal.style.display = "none";
                }

                span7.onclick = function () {
                    PM25Modal.style.display = "none";
                }

                // close modal after clicking outside the modal
                window.onclick = function (event) {
                    if (event.target === temperatureModal) {
                        temperatureModal.style.display = "none";
                    }
                    if (event.target === humidityModal) {
                        humidityModal.style.display = "none";
                    }
                    if (event.target === alcoholModal) {
                        alcoholModal.style.display = "none";
                    }
                    if (event.target === PM25Modal) {
                        PM25Modal.style.display = "none";
                    }
                    if (event.target === acetoneModal) {
                        acetoneModal.style.display = "none";
                    }
                    if (event.target === COModal) {
                        COModal.style.display = "none";
                    }
                    if (event.target === LPGModal) {
                        LPGModal.style.display = "none";
                    }
                }

                document.querySelector('#load');

                let firebaseDays = document.getElementById("firebaseDateArray");

                let temperatureDateSelect = document.getElementById("temperatureDateArray");
                let humidityDateSelect = document.getElementById("humidityDateArray");
                let alcoholDateSelect = document.getElementById("alcoholDateArray");
                let acetoneDateSelect = document.getElementById("acetoneDateArray");
                let LPGDateSelect = document.getElementById("LPGDateArray");
                let CODateSelect = document.getElementById("CODateArray");
                let PM25DateSelect = document.getElementById("PM25DateArray");

                let date, previousDateCount, currentDateCount;

                // get previous firebaseDays array length
                await firebase.database().ref('DHT11/Temperature/').once('value', (snap) => {
                    firebaseDays = snap.val();
                    firebaseDays = Object.keys(firebaseDays);
                    firebaseDays.sort(compareDate);
                    previousDateCount = firebaseDays.length;
                });

                // get latest date (final firebaseDays array element)
                async function loop10SecondDays() {
                    await firebase.database().ref('DHT11/Temperature/').once('value', (snap) => {
                        firebaseDays = snap.val();
                        firebaseDays = Object.keys(firebaseDays);
                        firebaseDays.sort(compareDate);
                        console.log(firebaseDays);
                        date = firebaseDays[firebaseDays.length - 1];
                    });
                }

                // get current firebaseDays array length
                // check if previous firebaseDays array length is different to current firebaseDays array length
                async function tallyDays() {
                    currentDateCount = firebaseDays.length;
                    if (previousDateCount !== currentDateCount) {
                        // refresh page
                        location.reload();
                    }
                }

                await loop10SecondDays();

                // rerun function every 10 seconds
                setInterval(function () {
                    loop10SecondDays();
                    tallyDays();
                }, 10000);

                // latest data (latest date)
                let currentDayTemperature = 'DHT11/Temperature/' + date;
                let currentDayHumidity = 'DHT11/Humidity/' + date;
                let currentDayAlcohol = 'MQ135/Alcohol/' + date;
                let currentDayAcetone = 'MQ135/Acetone/' + date;
                let currentDayLPG = 'MQ2/LPG/' + date;
                let currentDayCO = 'MQ2/CO/' + date;
                let currentDayPM25 = 'DSM501A/PM25/' + date;

                let timeStr;

                await RefDHT("DHT11/Temperature/", temperatureDateSelect, "temperatureDateArray");

                await firebase.database().ref(currentDayTemperature).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let latestTemperature = jsonReturnedParameter[1];
                    let jsonTemperatureValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("temperatureDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("temperatureChartContainer", "<canvas id=\"temperatureChart\"></canvas>", "temperatureChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    // compare latest temperature value
                    if (jsonTemperatureValue < 23) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#00AEEF";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#129398';
                    }
                    if (jsonTemperatureValue >= 23 && jsonTemperatureValue <= 26) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#4CBB17";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#128516';
                    }
                    if (jsonTemperatureValue > 26) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#bd1816";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#129397';
                    }
                    // latest date
                    document.getElementById('currentDate').innerHTML = "Date: " + date;
                    // latest time
                    timeStr = Object.keys(latestTemperature);
                    document.getElementById('currentTime').innerHTML = "Time: " + timeStr;

                    // latest temperature value
                    document.getElementById('latestTemperature').innerHTML = jsonTemperatureValue;
                });

                await RefDHT("DHT11/Humidity/", humidityDateSelect, "humidityDateArray");

                await firebase.database().ref(currentDayHumidity).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonHumidityValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("humidityDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("humidityChartContainer", "<canvas id=\"humidityChart\"></canvas>", "humidityChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonHumidityValue >= 0 && jsonHumidityValue < 60) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#4CBB17";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128516;';
                    }
                    if (jsonHumidityValue >= 60 && jsonHumidityValue < 80) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#FFA500";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128577;';
                    }
                    if (jsonHumidityValue >= 80) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#bd1816";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128543;';
                    }

                    document.getElementById('latestHumidity').innerHTML = jsonHumidityValue;
                });

                await RefDHT("MQ135/Alcohol/", alcoholDateSelect, "alcoholDateArray");

                await firebase.database().ref(currentDayAlcohol).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonAlcoholValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("alcoholDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("alcoholChartContainer", "<canvas id=\"alcoholChart\"></canvas>", "alcoholChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonAlcoholValue <= 100) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#4CBB17";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128516;';
                    }
                    if (jsonAlcoholValue > 100 && jsonAlcoholValue <= 200) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#FFA500";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128577;';
                    }
                    if (jsonAlcoholValue > 200 && jsonAlcoholValue <= 400) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#bd1816";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128567;';
                    }
                    if (jsonAlcoholValue > 400) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#000000";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestAlcohol').innerHTML = jsonAlcoholValue;
                });

                await RefDHT("MQ135/Acetone/", acetoneDateSelect, "acetoneDateArray");

                await firebase.database().ref(currentDayAcetone).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonAcetoneValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("acetoneDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("acetoneChartContainer", "<canvas id=\"acetoneChart\"></canvas>", "acetoneChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonAcetoneValue <= 100) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#4CBB17";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128516;';
                    }
                    if (jsonAcetoneValue > 100 && jsonAcetoneValue < 250) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#FFA500";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128577;';
                    }
                    if (jsonAcetoneValue > 250 && jsonAcetoneValue <= 500) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#bd1816";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128567;';
                    }
                    if (jsonAcetoneValue > 500) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#000000";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestAcetone').innerHTML = jsonAcetoneValue;
                });

                await RefDHT("MQ2/LPG/", LPGDateSelect, "LPGDateArray");

                await firebase.database().ref(currentDayLPG).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonLPGValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("LPGDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("LPGChartContainer", "<canvas id=\"LPGChart\"></canvas>", "LPGChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonLPGValue <= 500) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#4CBB17";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128516;';
                    }
                    if (jsonLPGValue > 500 && jsonLPGValue <= 1000) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#FFA500";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128577;';
                    }
                    if (jsonLPGValue > 1000 && jsonLPGValue <= 1250) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#bd1816";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128567;';
                    }
                    if (jsonLPGValue > 1250) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#000000";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestLPG').innerHTML = jsonLPGValue;
                });

                await RefDHT("MQ2/CO/", CODateSelect, "CODateArray");

                await firebase.database().ref(currentDayCO).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonCOValue = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("LPGDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("COChartContainer", "<canvas id=\"COChart\"></canvas>", "COChart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonCOValue <= 6) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128516;';
                        document.getElementById("COIndicator").style.backgroundColor = "#4CBB17";
                    }
                    if (jsonCOValue > 6 && jsonCOValue <= 50) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128577;';
                        document.getElementById("COIndicator").style.backgroundColor = "#FFA500";
                    }
                    if (jsonCOValue > 50 && jsonCOValue <= 200) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128567;';
                        document.getElementById("COIndicator").style.backgroundColor = "#bd1816";
                    }
                    if (jsonCOValue > 200) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128128;';
                        document.getElementById("COIndicator").style.backgroundColor = "#000000";
                    }

                    document.getElementById('latestCO').innerHTML = jsonCOValue;
                });

                await RefDHT("DSM501A/PM25/", PM25DateSelect, "PM25DateArray");

                await firebase.database().ref(currentDayPM25).on('value', (snap) => {
                    let jsonReturnedParameter = jsonLatestParameterReturnCompare(snap.val());
                    let parameterArray = jsonReturnedParameter[0];
                    let jsonPM25Value = jsonReturnedParameter[2];

                    let parameterValueArray = cleanParameterPush(parameterArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("PM25DateArray").value === date) {
                        let yAxisValues = dynamicYAxis(parameterValueArray[1])

                        generateChart("PM25ChartContainer", "<canvas id=\"PM25Chart\"></canvas>", "PM25Chart",
                            parameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    if (jsonPM25Value <= 12) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128516;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#4CBB17";
                    }
                    if (jsonPM25Value > 12 && jsonPM25Value <= 35) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128577;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#FFA500";
                    }
                    if (jsonPM25Value > 35 && jsonPM25Value <= 55) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128567;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#bd1816";
                    }
                    if (jsonPM25Value > 55) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128128;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#000000";
                    }

                    document.getElementById('latestPM25').innerHTML = jsonPM25Value;
                });
            }
        );
    </script>
</div>
</body>
</html>