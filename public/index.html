<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- desktop view on all screen sizes -->
    <meta name="viewport" content="width=device-width, initial-scale=0.1">
    <title>Air Quality Monitor Dashboard</title>

    <script defer src="/__/firebase/9.8.4/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/9.8.4/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
    th {
        color: #000000;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        padding-top: 100px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
    }

    .modal-header {
        padding: 2px 16px;
        background-color: #23408e;
        color: white;
    }

    .close {
        color: white;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    body {
        background-image: url(https://img.freepik.com/premium-vector/background-white-elegant-texture_23-2148438404.jpg?w=2000);
    }

    canvas {
        max-height: 700px;
    }

    select {
        margin-bottom: 15px;
    }
</style>

<body>
<div class="container">
    <div class="row" style="text-align: center; padding: 30px 0;">
        <div class="col-md-3"></div>
        <div class="col-md-3">
            <h3 id="currentDate"></h3>
        </div>
        <div class="col-md-3">
            <h3 id="currentTime"></h3>
        </div>
        <div class="col-md-3"></div>
    </div>

    <!-- hidden firebase (temperature) date drop-down menu (used for timed refresh array purposes only) -->
    <select hidden id="firebaseDateArray"></select>

    <!-- modal for temperature dashboard -->
    <div id="temperatureModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Temperature Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <!-- temperature date drop-down menu -->
                <label for="temperatureDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="temperatureDateArray"
                        onchange="selectTemperatureOption()"></select>
                <!-- temperature data chart -->
                <div id="temperatureChartContainer">
                    <canvas id="temperatureChart"></canvas>
                </div>
                <span style="color: #00AEEF">< 23&#8451: Low Temperature &#129398;</span>
                <br>
                <span style="color: #4CBB17">23&#8451 - 26&#8451: Recommended Indoor Temperature &#128516; (Department of Standards Malaysia)</span>
                <br>
                <span style="color: #bd1816">> 26&#8451: High Temperature &#129397;</span>
                <br>
                <a href="http://www.mgbc.org.my/Downloads/08052018_MUIGBC2018_E-PROCEEDING_PAPER/20180508_3_Indoor_and_Outdoor_Environmental_Quality/8_Assessment_of_Indoor_Air_Temperature_of_a_Low_Cost_Single_Story_Detached_House.pdf">
                <span style="float: right">
                    Department of Standards Malaysia &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for humidity dashboard-->
    <div id="humidityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Humidity Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="humidityDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="humidityDateArray"
                        onchange="selectHumidityOption()"></select>
                <div id="humidityChartContainer">
                    <canvas id="humidityChart"></canvas>
                </div>
                <span style="color: #4CBB17">0% - 59%: Low Risk of Mold Growth &#128516;</span>
                <br>
                <span style="color: #FFA500">60% - 79%: Risk of Mold Growth &#128577;</span>
                <br>
                <span style="color: #bd1816">80% - 100%: High Risk of Mold Growth &#128543;</span>
                <br>
                <a href="https://indoorscience.com/blog/relative-humidity-and-mold/">
                <span style="float: right">
                    IndoorScience &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for alcohol dashboard-->
    <div id="alcoholModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Alcohol Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="alcoholDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="alcoholDateArray"
                        onchange="selectAlcoholOption()"></select>
                <div id="alcoholChartContainer">
                    <canvas id="alcoholChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 100ppm: Safe Levels of Alcohol &#128516;</span>
                <br>
                <span style="color: #FFA500">> 100ppm - 200ppm: Permissible Levels of Alcohol &#128577; (ACGIH TLV - 8 Hours = 200ppm)</span>
                <br>
                <span style="color: #bd1816">> 200ppm - 400ppm: Alarming Levels of Alcohol &#128567; (ACGIH TLV - 15 Minutes = 400ppm)</span>
                <br>
                <span style="color: #000000">> 400ppm: Hazardous Levels of Alcohol &#128128;</span>
                <br>
                <a href="https://www.chemtronics.com/Content/Images/uploaded/documents/CW8300_United%20States%20(US)%20SDS%20HCS%202012_English%20(US).pdf">
                <span style="float: right">
                    Chemtronics &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for acetone dashboard-->
    <div id="acetoneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acetone Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="acetoneDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="acetoneDateArray"
                        onchange="selectAcetoneOption()"></select>
                <div id="acetoneChartContainer">
                    <canvas id="acetoneChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 100ppm: Safe Levels of Acetone &#128516;</span>
                <br>
                <span style="color: #FFA500">> 100ppm - 250ppm: Permissible Levels of Acetone &#128577; (ACGIH TLV - 8 Hours = 250ppm)</span>
                <br>
                <span style="color: #bd1816">> 250ppm - 500ppm: Alarming Levels of Acetone &#128567; (ACGIH TLV - 15 Minutes = 500ppm)</span>
                <br>
                <span style="color: #000000">> 500ppm: Hazardous Levels of Acetone &#128128;</span>
                <br>
                <a href="https://www.ccohs.ca/oshanswers/chemicals/chem_profiles/acetone.html">
                <span style="float: right">
                    Canadian Centre for Occupational Health and Safety &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for lpg dashboard-->
    <div id="LPGModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Liquefied Petroleum Gas Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="LPGDateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="LPGDateArray" onchange="selectLPGOption()"></select>
                <div id="LPGChartContainer">
                    <canvas id="LPGChart"></canvas>
                </div>
                <span style="color: #4CBB17">0 - 500ppm: Safe Levels of LPG &#128516; </span>
                <br>
                <span style="color: #FFA500">> 500ppm - 1000ppm: Permissible Levels of LPG &#128577; (ACGIH TLV - 8 Hours = 1000ppm)</span>
                <br>
                <span style="color: #bd1816">> 1000ppm - 1250ppm: Alarming Levels of LPG &#128567;</span>
                <br>
                <span style="color: #000000">> 1250ppm: Hazardous Levels of LPG &#128128;</span>
                <br>
                <a href="https://www.cdc.gov/niosh/idlh/68476857.html">
                <span style="float: right">
                    The National Institute for Occupational Safety and Health &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for carbon monoxide dashboard-->
    <div id="COModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Carbon Monoxide Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="CODateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="CODateArray" onchange="selectCOOption()"></select>
                <div id="COChartContainer">
                    <canvas id="COChart"></canvas>
                </div>
                <span style="color: #4CBB17">0ppm - 6ppm: Safe Levels of CO &#128516; (WHO 24 Hour Average = 6ppm)</span>
                <br>
                <span style="color: #FFA500">> 6ppm - 50ppm: Permissible Levels of CO &#128577; (OSHA PEL - 8 Hours = 50ppm)</span>
                <br>
                <span style="color: #bd1816">> 50ppm - 200ppm: Alarming Levels of CO &#128567; (NIOSH STEL - 15 Minutes = 200ppm)</span>
                <br>
                <span style="color: #000000">> 200 ppm: Hazardous Levels of CO &#128128;</span>
                <br>
                <a href="https://gaslab.com/blogs/articles/carbon-monoxide-levels-chart">
                <span style="float: right">
                    GasLab &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <!--    modal for pm2.5 particulate dashboard-->
    <div id="PM25Modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>PM2.5 Particulate Dashboard</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <label for="PM25DateArray"></label>
                <select class="btn-secondary dropdown-toggle" id="PM25DateArray" onchange="selectPM25Option()"></select>
                <div id="PM25ChartContainer">
                    <canvas id="PM25Chart"></canvas>
                </div>
                <span style="color: #4CBB17">0μg/m<sup>3</sup> - 12μg/m<sup>3</sup>: Safe Levels of PM2.5 Particulate Matter &#128516; (EPA Annual PM2.5 Standard = 12μg/m<sup>3</sup>)</span>
                <br>
                <span style="color: #FFA500">> 12μg/m<sup>3</sup> - 35μg/m<sup>3</sup> = Permissible Levels of PM2.5 Particulate Matter &#128577; (EPA 24-Hour PM2.5 Standard = 35μg/m<sup>3</sup>)</span>
                <br>
                <span style="color: #bd1816">> 35μg/m<sup>3</sup> - 55μg/m<sup>3</sup> = Alarming Levels of PM2.5 Particulate Matter &#128567;</span>
                <br>
                <span style="color: #000000">> 55μg/m<sup>3</sup> = Hazardous Levels of PM2.5 Particulate Matter &#128128;</span>
                <br>
                <a href="https://www.epa.gov/sites/default/files/2016-04/documents/2012_aqi_factsheet.pdf">
                <span style="float: right">
                    Environmental Protection Agency &#128214;
                </span>
                </a>
            </div>
        </div>
    </div>

    <div class="row" style="justify-content: space-between;">
        <div id="temperatureIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 3%;">
            <h5 style="color: #fff;">Temperature &#127777;</h5>
            <h1 id="latestTemperature" style="color: #fff;"></h1>
        </div>
        <div id="humidityIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Humidity &#128167;</h5>
            <h1 id="latestHumidity" style="color: #fff;"></h1>
        </div>
        <div id="PM25Indicator" class="col-md-3" style="background-color:
        #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
        box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">PM2.5 Particulate&#128173;</h5>
            <h1 id="latestPM25" style="color: #fff;"></h1>
        </div>
    </div>

    <div class="row mt-5" style="justify-content: space-between;">
        <div id="alcoholIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Alcohol (C<sub>2</sub>H<sub>5</sub>OH)</h5>

            <h1 id="latestAlcohol" style="color: #fff;"></h1>
        </div>
        <div id="acetoneIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Acetone (C<sub>3</sub>H<sub>6</sub>O)</h5>
            <h1 id="latestAcetone" style="color: #fff;"></h1>
        </div>

        <div id="LPGIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Liquefied Petroleum Gas (C<sub>3</sub>H<sub>8</sub>)</h5>

            <h1 id="latestLPG" style="color: #fff;"></h1>
        </div>
    </div>

    <div class="row mt-5" style="justify-content: center;">
        <div id="COIndicator" class="col-md-3" style="background-color:
          #23408e; text-align: center; padding: 15px 0; border-radius: 30px;
          box-shadow: 5px 5px 5px grey; margin-right: 2%;">
            <h5 style="color: #fff;">Carbon Monoxide (CO)</h5>
            <h1 id="latestCO" style="color: #fff;"></h1>
        </div>

    </div>
    <script>
        // reload page once again on page load to prevent chart.js loading glitches
        window.onload = function () {
            if (!window.location.hash) {
                window.location = window.location + '#loaded';
                window.location.reload();
            }
        }

        // dateArray.sort(compareDate) to sort date array from oldest to latest
        function compareDate(a, b) {
            const date1 = new Date(a)
            const date2 = new Date(b)
            return date1 - date2;
        }

        // convert array of strings to array of numbers
        function convertStringToNumberArray(stringArray, numberArray) {
            stringArray.forEach(str => {
                numberArray.push(Number(str));
            });
            return numberArray;
        }

        // findHighestInArray(array) to find highest value in array
        function findHighestInArray(array) {
            let highest = array[0];
            for (let i = 0; i < array.length; i++) {
                if (array[i] > highest) {
                    highest = array[i];
                }
            }
            return highest;
        }

        // findLowestInArray(array) to find lowest value in array
        function findLowestInArray(array) {
            let lowest = array[0];
            for (let i = 0; i < array.length; i++) {
                if (array[i] < lowest) {
                    lowest = array[i];
                }
            }
            return lowest;
        }

        function generateChart(parameterChartContainer, canvasChart, chartName, timeArray, parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling) {
            // empty and reload the div to prevent other parameter chart data from other days from being shown
            // when hovering over parameter chart data points
            document.getElementById(parameterChartContainer.toString()).innerHTML = "";
            document.getElementById(parameterChartContainer.toString()).innerHTML = canvasChart.toString();
            new Chart(chartName, {
                type: "line",
                data: {
                    labels: timeArray,
                    datasets: [{
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(0,0,255,1.0)",
                        borderColor: "rgba(0,0,255,0.1)",
                        data: parameterValueNumberArray

                    }]
                },
                options: {
                    legend: {display: false},
                    scales: {
                        yAxes: [{ticks: {min: lowestParameterCeiling, max: highestParameterCeiling}}],
                        // limit x axis to 24 ticks
                        xAxes: [{
                            ticks: {
                                display: true,
                                autoSkip: true,
                                maxTicksLimit: 24
                            }
                        }],
                    }
                }
            });
        }

        function selectParameterOption(parameterDateArray, sensorParameter) {
            // get selected parameter date
            let selectedParameterDate = document.getElementById(parameterDateArray.toString()).value;
            let selectedDayParameter = sensorParameter.toString() + selectedParameterDate;
            let timeArray = [];
            let parameterArray = [];
            let parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling;

            // retrieve firebase realtime database data of the selected parameter date
            firebase.database().ref(selectedDayParameter).on('value', (snap) => {
                let parameterStr = snap.val();
                let parameterValueArray = [];

                // insert retrieved selected parameter date data into array
                Object.keys(parameterStr).forEach((key) => {
                    parameterArray.push({[key]: parameterStr[key]});
                });

                let iterator = parameterArray.values();

                for (let elements of iterator) {
                    // insert selected parameter date data array element keys (time) into time array
                    timeArray.push(Object.keys(elements).toString());
                    // json converted to string for the selected parameter date data array element value (parameter)
                    let cleanParameter = JSON.stringify(Object.values(elements));
                    // remove unnecessary string data and be left with only actual parameter value
                    cleanParameter = cleanParameter.split(":").pop();
                    cleanParameter = cleanParameter.replaceAll("\"", "");
                    cleanParameter = cleanParameter.replaceAll("}", "");
                    cleanParameter = cleanParameter.replaceAll("]", "");
                    // insert actual parameter value into parameter value array
                    parameterValueArray.push(cleanParameter);
                }

                let yAxisValues = dynamicYAxis(parameterValueArray)
                parameterValueNumberArray = yAxisValues[0];
                lowestParameterCeiling = yAxisValues[1];
                highestParameterCeiling = yAxisValues[2];
            });
            return [timeArray, parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling];
        }


        function cleanParameterPush(parameterArray){
            let iterator = parameterArray.values();
            let timeArray = [];
            let parameterValueArray = [];

            for (let elements of iterator) {
                // insert latest temperature array element keys (time) into time array
                timeArray.push(Object.keys(elements).toString());
                // json converted to string for the latest temperature array element value (temperature)
                let cleanParameter = JSON.stringify(Object.values(elements));
                // remove unnecessary string data and be left with only actual temperature value
                cleanParameter = cleanParameter.split(":").pop();
                cleanParameter = cleanParameter.replaceAll("\"", "");
                cleanParameter = cleanParameter.replaceAll("}", "");
                cleanParameter = cleanParameter.replaceAll("]", "");
                // insert actual temperature value into temperature value array
                parameterValueArray.push(cleanParameter);
            }

            return [timeArray, parameterValueArray];
        }


        function jsonParameterReturnCompare(parameterStr) {
            let parameterArray = [];

            // insert retrieved latest temperature data into temperature array
            Object.keys(parameterStr).forEach((key) => {
                parameterArray.push({[key]: parameterStr[key]});
            });

            // json converted to string for final (latest) temperature array element value
            let latestParameter = parameterArray[parameterArray.length - 1];
            let parameterValue = Object.values(latestParameter);
            let jsonParameterValue = JSON.stringify(parameterValue);

            // remove unnecessary string data and be left with only actual latest temperature value
            jsonParameterValue = jsonParameterValue.split(":").pop();
            jsonParameterValue = jsonParameterValue.replaceAll("\"", "");
            jsonParameterValue = jsonParameterValue.replaceAll("}", "");
            jsonParameterValue = jsonParameterValue.replaceAll("]", "");

            return [parameterArray, latestParameter, jsonParameterValue];
        }

        function dynamicYAxis(parameterValueArray) {
            // dynamic chart y axis min max based on lowest and highest values
            let temporaryNumberArray = [];
            let parameterValueNumberArray = convertStringToNumberArray(parameterValueArray, temporaryNumberArray);
            let lowestParameter, highestParameter;
            lowestParameter = findLowestInArray(parameterValueNumberArray);
            highestParameter = findHighestInArray(parameterValueNumberArray);
            let lowestParameterCeiling = Math.round((Math.round(lowestParameter)) / 10) * 10;
            let highestParameterCeiling = Math.round((Math.round(highestParameter)) / 10) * 10;

            if (highestParameterCeiling === lowestParameterCeiling) {
                highestParameterCeiling = highestParameterCeiling + 10;
            }
            if (highestParameter > highestParameterCeiling) {
                while (highestParameter > highestParameterCeiling) {
                    highestParameterCeiling += 10;
                }
            }
            if (lowestParameter < lowestParameterCeiling) {
                while (lowestParameter < lowestParameterCeiling) {
                    lowestParameterCeiling -= 10;
                }
            }

            return [parameterValueNumberArray, lowestParameterCeiling, highestParameterCeiling];
        }

        // obtain historical temperature data after selecting temperature date from drop-down menu
        function selectTemperatureOption() {
            let parameterArray = selectParameterOption("temperatureDateArray", 'DHT11/Temperature/');
            console.log(parameterArray);
            generateChart("temperatureChartContainer", "<canvas id=\"temperatureChart\"></canvas>", "temperatureChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectHumidityOption() {
            let parameterArray = selectParameterOption("humidityDateArray", 'DHT11/Humidity/');
            generateChart("humidityChartContainer", "<canvas id=\"humidityChart\"></canvas>", "humidityChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectAlcoholOption() {
            let parameterArray = selectParameterOption("alcoholDateArray", 'MQ135/Alcohol/');
            generateChart("alcoholChartContainer", "<canvas id=\"alcoholChart\"></canvas>", "alcoholChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectAcetoneOption() {
            let parameterArray = selectParameterOption("acetoneDateArray", 'MQ135/Acetone/');
            generateChart("acetoneChartContainer", "<canvas id=\"acetoneChart\"></canvas>", "acetoneChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectLPGOption() {
            let parameterArray = selectParameterOption("LPGateArray", 'MQ2/LPG/');
            generateChart("LPGChartContainer", "<canvas id=\"LPGChart\"></canvas>", "LPGChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectCOOption() {
            let parameterArray = selectParameterOption("CODateArray", 'MQ2/CO/');
            generateChart("COChartContainer", "<canvas id=\"COChart\"></canvas>", "COChart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        function selectPM25Option() {
            let parameterArray = selectParameterOption("PM25DateArray", 'DSM501A/PM25/');
            generateChart("PM25ChartContainer", "<canvas id=\"PM25Chart\"></canvas>", "PM25Chart",
                parameterArray[0], parameterArray[1], parameterArray[2], parameterArray[3]);
        }

        document.addEventListener('DOMContentLoaded', async function () {
                var temperatureModal = document.getElementById("temperatureModal");
                var humidityModal = document.getElementById("humidityModal");
                var alcoholModal = document.getElementById("alcoholModal");
                var acetoneModal = document.getElementById("acetoneModal");
                var LPGModal = document.getElementById("LPGModal");
                var COModal = document.getElementById("COModal");
                var PM25Modal = document.getElementById("PM25Modal");

                var temperatureBtn = document.getElementById("temperatureIndicator");
                var humidityBtn = document.getElementById("humidityIndicator");
                var alcoholBtn = document.getElementById("alcoholIndicator");
                var acetoneBtn = document.getElementById("acetoneIndicator");
                var LPGBtn = document.getElementById("LPGIndicator");
                var COBtn = document.getElementById("COIndicator");
                var PM25Btn = document.getElementById("PM25Indicator");

                var span1 = document.getElementsByClassName("close")[0];
                var span2 = document.getElementsByClassName("close")[1];
                var span3 = document.getElementsByClassName("close")[2];
                var span4 = document.getElementsByClassName("close")[3];
                var span5 = document.getElementsByClassName("close")[4];
                var span6 = document.getElementsByClassName("close")[5];
                var span7 = document.getElementsByClassName("close")[6];


                // show modal after clicking data indicator
                temperatureBtn.onclick = function () {
                    temperatureModal.style.display = "block";
                }

                humidityBtn.onclick = function () {
                    humidityModal.style.display = "block";
                }

                alcoholBtn.onclick = function () {
                    alcoholModal.style.display = "block";
                }

                PM25Btn.onclick = function () {
                    PM25Modal.style.display = "block";
                }

                acetoneBtn.onclick = function () {
                    acetoneModal.style.display = "block";
                }

                LPGBtn.onclick = function () {
                    LPGModal.style.display = "block";
                }

                COBtn.onclick = function () {
                    COModal.style.display = "block";
                }

                // close modal after clicking "x" (close) modal button
                span1.onclick = function () {
                    temperatureModal.style.display = "none";
                }

                span2.onclick = function () {
                    humidityModal.style.display = "none";
                }

                span3.onclick = function () {
                    alcoholModal.style.display = "none";
                }

                span4.onclick = function () {
                    acetoneModal.style.display = "none";
                }

                span5.onclick = function () {
                    LPGModal.style.display = "none";
                }

                span6.onclick = function () {
                    COModal.style.display = "none";
                }

                span7.onclick = function () {
                    PM25Modal.style.display = "none";
                }

                // close modal after clicking outside the modal
                window.onclick = function (event) {
                    if (event.target === temperatureModal) {
                        temperatureModal.style.display = "none";
                    }
                    if (event.target === humidityModal) {
                        humidityModal.style.display = "none";
                    }
                    if (event.target === alcoholModal) {
                        alcoholModal.style.display = "none";
                    }
                    if (event.target === PM25Modal) {
                        PM25Modal.style.display = "none";
                    }
                    if (event.target === acetoneModal) {
                        acetoneModal.style.display = "none";
                    }
                    if (event.target === COModal) {
                        COModal.style.display = "none";
                    }
                    if (event.target === LPGModal) {
                        LPGModal.style.display = "none";
                    }
                }

                document.querySelector('#load');

                var firebaseDays = document.getElementById("firebaseDateArray");

                var temperatureDateSelect = document.getElementById("temperatureDateArray");
                var humidityDateSelect = document.getElementById("humidityDateArray");
                var alcoholDateSelect = document.getElementById("alcoholDateArray");
                var acetoneDateSelect = document.getElementById("acetoneDateArray");
                var LPGDateSelect = document.getElementById("LPGDateArray");
                var CODateSelect = document.getElementById("CODateArray");
                var PM25DateSelect = document.getElementById("PM25DateArray");

                var date, previousDateCount, currentDateCount;

                // get previous firebaseDays array length
                await firebase.database().ref('DHT11/Temperature/').once('value', (snap) => {
                    firebaseDays = snap.val();
                    firebaseDays = Object.keys(firebaseDays);
                    firebaseDays.sort(compareDate);
                    previousDateCount = firebaseDays.length;
                });

                // get latest date (final firebaseDays array element)
                async function loop10SecondDays() {
                    await firebase.database().ref('DHT11/Temperature/').once('value', (snap) => {
                        firebaseDays = snap.val();
                        firebaseDays = Object.keys(firebaseDays);
                        firebaseDays.sort(compareDate);
                        console.log(firebaseDays);
                        date = firebaseDays[firebaseDays.length - 1];
                    });
                }

                // get current firebaseDays array length
                // check if previous firebaseDays array length is different to current firebaseDays array length
                async function tallyDays() {
                    currentDateCount = firebaseDays.length;
                    if (previousDateCount !== currentDateCount) {
                        // refresh page
                        location.reload();
                    }
                }

                await loop10SecondDays();

                // rerun function every 10 seconds
                setInterval(function () {
                    loop10SecondDays();
                    tallyDays();
                }, 10000);

                // latest data (latest date)
                let currentDayTemperature = 'DHT11/Temperature/' + date;
                let currentDayHumidity = 'DHT11/Humidity/' + date;
                let currentDayAlcohol = 'MQ135/Alcohol/' + date;
                let currentDayAcetone = 'MQ135/Acetone/' + date;
                let currentDayLPG = 'MQ2/LPG/' + date;
                let currentDayCO = 'MQ2/CO/' + date;
                let currentDayPM25 = 'DSM501A/PM25/' + date;

                var timeStr;

                async function RefDHT(DHTParameter, parameterDateSelect, parameterDateArray) {
                    await firebase.database().ref(DHTParameter.toString()).once('value', (snap) => {
                        let parameterDays = snap.val();
                        parameterDays = Object.keys(parameterDays);
                        // sort parameter date array from oldest to latest
                        parameterDays.sort(compareDate);
                        // load parameter date data into parameter date drop-down menu
                        for (var i = 0; i < parameterDays.length; i++) {
                            var option = parameterDays[i];
                            var element = document.createElement("option");
                            element.textContent = option;
                            element.value = option;
                            parameterDateSelect.prepend(element);
                        }
                        // select latest parameter date by default
                        document.getElementById(parameterDateArray.toString()).selectedIndex = "0";
                    });
                }

                await RefDHT("DHT11/Temperature/", temperatureDateSelect, "temperatureDateArray");

                await firebase.database().ref(currentDayTemperature).on('value', (snap) => {
                    var temperatureStr = snap.val();
                    var jsonReturnedParameter = jsonParameterReturnCompare(temperatureStr);
                    var temperatureArray = jsonReturnedParameter[0];
                    var latestTemperature = jsonReturnedParameter[1];
                    var jsonTemperatureValue = jsonReturnedParameter[2];

                    // compare latest temperature value
                    if (jsonTemperatureValue < 23) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#00AEEF";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#129398';
                    }
                    if (jsonTemperatureValue >= 23 && jsonTemperatureValue <= 26) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#4CBB17";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#128516';
                    }
                    if (jsonTemperatureValue > 26) {
                        document.getElementById("temperatureIndicator").style.backgroundColor = "#bd1816";
                        jsonTemperatureValue = jsonTemperatureValue + '&#8451' + '&#129397';
                    }

                    let timeAndParameterValueArray = cleanParameterPush(temperatureArray);

                    // load chart if latest date is equal to selected temperature date in drop-down menu
                    if (document.getElementById("temperatureDateArray").value === date) {
                        let yAxisValues = dynamicYAxis(timeAndParameterValueArray[1])

                        generateChart("temperatureChartContainer", "<canvas id=\"temperatureChart\"></canvas>", "temperatureChart",
                            timeAndParameterValueArray[0], yAxisValues[0], yAxisValues[1], yAxisValues[2]);
                    }

                    // latest temperature value
                    document.getElementById('latestTemperature').innerHTML = jsonTemperatureValue;
                    // latest date
                    document.getElementById('currentDate').innerHTML = "Date: " + date;
                    // latest time
                    timeStr = Object.keys(latestTemperature);
                    document.getElementById('currentTime').innerHTML = "Time: " + timeStr;
                });

                await RefDHT("DHT11/Humidity/", humidityDateSelect, "humidityDateArray");

                firebase.database().ref(currentDayHumidity).on('value', (snap) => {
                    var humidityStr = snap.val();
                    var humidityArray = [];
                    Object.keys(humidityStr).forEach((key) => {
                        humidityArray.push({[key]: humidityStr[key]});
                    });

                    var latestHumidity = humidityArray[humidityArray.length - 1];
                    var humidityValue = Object.values(latestHumidity);
                    var jsonHumidityValue = JSON.stringify(humidityValue);

                    jsonHumidityValue = jsonHumidityValue.split(":").pop();
                    jsonHumidityValue = jsonHumidityValue.replaceAll("\"", "");
                    jsonHumidityValue = jsonHumidityValue.replaceAll("}", "");
                    jsonHumidityValue = jsonHumidityValue.replaceAll("]", "");

                    if (jsonHumidityValue >= 0 && jsonHumidityValue < 60) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#4CBB17";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128516;';
                    }
                    if (jsonHumidityValue >= 60 && jsonHumidityValue < 80) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#FFA500";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128577;';
                    }
                    if (jsonHumidityValue >= 80) {
                        document.getElementById("humidityIndicator").style.backgroundColor = "#bd1816";
                        jsonHumidityValue = jsonHumidityValue + "%" + '&#128543;';
                    }

                    document.getElementById('latestHumidity').innerHTML = jsonHumidityValue;
                    var iterator = humidityArray.values();

                    var timeArray = [];
                    var humidityValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanHumidity = JSON.stringify(Object.values(elements));
                        cleanHumidity = cleanHumidity.split(":").pop();
                        cleanHumidity = cleanHumidity.replaceAll("\"", "");
                        cleanHumidity = cleanHumidity.replaceAll("}", "");
                        cleanHumidity = cleanHumidity.replaceAll("]", "");
                        humidityValueArray.push(cleanHumidity);
                    }

                    if (document.getElementById("humidityDateArray").value === date) {
                        let temporaryNumberArray = [];
                        let humidityValueNumberArray = convertStringToNumberArray(humidityValueArray, temporaryNumberArray);
                        let lowestHumidity, highestHumidity;
                        lowestHumidity = findLowestInArray(humidityValueNumberArray);
                        highestHumidity = findHighestInArray(humidityValueNumberArray);
                        let lowestHumidityCeiling, highestHumidityCeiling;
                        lowestHumidityCeiling = Math.round((Math.round(lowestHumidity)) / 10) * 10;
                        highestHumidityCeiling = Math.round((Math.round(highestHumidity)) / 10) * 10;
                        if (highestHumidityCeiling === lowestHumidityCeiling) {
                            highestHumidityCeiling = highestHumidityCeiling + 10;
                        }
                        if (highestHumidity > highestHumidityCeiling) {
                            while (highestHumidity > highestHumidityCeiling) {
                                highestHumidityCeiling += 10;
                            }
                        }
                        if (lowestHumidity < lowestHumidityCeiling) {
                            while (lowestHumidity < lowestHumidityCeiling) {
                                lowestHumidityCeiling -= 10;
                            }
                        }

                        document.getElementById('humidityChartContainer').innerHTML = "";
                        document.getElementById('humidityChartContainer').innerHTML = "<canvas id=\"humidityChart\"></canvas>";
                        generateChart("humidityChart", timeArray, humidityValueArray, lowestHumidityCeiling, highestHumidityCeiling);
                    }
                });

                await RefDHT("MQ135/Alcohol/", alcoholDateSelect, "alcoholDateArray");
                firebase.database().ref(currentDayAlcohol).on('value', (snap) => {
                    var alcoholStr = snap.val();
                    var alcoholArray = [];
                    Object.keys(alcoholStr).forEach((key) => {
                        alcoholArray.push({[key]: alcoholStr[key]});
                    });

                    var latestAlcohol = alcoholArray[alcoholArray.length - 1];
                    var alcoholValue = Object.values(latestAlcohol);
                    var jsonAlcoholValue = JSON.stringify(alcoholValue);

                    jsonAlcoholValue = jsonAlcoholValue.split(":").pop();
                    jsonAlcoholValue = jsonAlcoholValue.replaceAll("\"", "");
                    jsonAlcoholValue = jsonAlcoholValue.replaceAll("}", "");
                    jsonAlcoholValue = jsonAlcoholValue.replaceAll("]", "");

                    if (jsonAlcoholValue <= 100) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#4CBB17";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128516;';
                    }
                    if (jsonAlcoholValue > 100 && jsonAlcoholValue <= 200) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#FFA500";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128577;';
                    }
                    if (jsonAlcoholValue > 200 && jsonAlcoholValue <= 400) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#bd1816";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128567;';
                    }
                    if (jsonAlcoholValue > 400) {
                        document.getElementById("alcoholIndicator").style.backgroundColor = "#000000";
                        jsonAlcoholValue = jsonAlcoholValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestAlcohol').innerHTML = jsonAlcoholValue;
                    var iterator = alcoholArray.values();

                    var timeArray = [];
                    var alcoholValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanAlcohol = JSON.stringify(Object.values(elements));
                        cleanAlcohol = cleanAlcohol.split(":").pop();
                        cleanAlcohol = cleanAlcohol.replaceAll("\"", "");
                        cleanAlcohol = cleanAlcohol.replaceAll("}", "");
                        cleanAlcohol = cleanAlcohol.replaceAll("]", "");
                        alcoholValueArray.push(cleanAlcohol);
                    }

                    if (document.getElementById("alcoholDateArray").value === date) {
                        let temporaryNumberArray = [];
                        let alcoholValueNumberArray = convertStringToNumberArray(alcoholValueArray, temporaryNumberArray);
                        let lowestAlcohol, highestAlcohol;
                        lowestAlcohol = findLowestInArray(alcoholValueNumberArray);
                        highestAlcohol = findHighestInArray(alcoholValueNumberArray);
                        let lowestAlcoholCeiling, highestAlcoholCeiling;
                        lowestAlcoholCeiling = Math.round((Math.round(lowestAlcohol)) / 10) * 10;
                        highestAlcoholCeiling = Math.round((Math.round(highestAlcohol)) / 10) * 10;
                        if (highestAlcoholCeiling === lowestAlcoholCeiling) {
                            highestAlcoholCeiling = highestAlcoholCeiling + 10;
                        }
                        if (highestAlcohol > highestAlcoholCeiling) {
                            while (highestAlcohol > highestAlcoholCeiling) {
                                highestAlcoholCeiling += 10;
                            }
                        }
                        if (lowestAlcohol < lowestAlcoholCeiling) {
                            while (lowestAlcohol < lowestAlcoholCeiling) {
                                lowestAlcoholCeiling -= 10;
                            }
                        }

                        document.getElementById("alcoholChartContainer").innerHTML = "";
                        document.getElementById('alcoholChartContainer').innerHTML = "<canvas id=\"alcoholChart\"></canvas>";
                        generateChart("alcoholChart", timeArray, alcoholValueNumberArray, lowestAlcoholCeiling, highestAlcoholCeiling);
                    }
                });

                await RefDHT("MQ135/Acetone/", acetoneDateSelect, "acetoneDateArray");
                firebase.database().ref(currentDayAcetone).on('value', (snap) => {
                    var acetoneStr = snap.val();
                    var acetoneArray = [];
                    Object.keys(acetoneStr).forEach((key) => {
                        acetoneArray.push({[key]: acetoneStr[key]});
                    });

                    var latestAcetone = acetoneArray[acetoneArray.length - 1];
                    var acetoneValue = Object.values(latestAcetone);
                    var jsonAcetoneValue = JSON.stringify(acetoneValue);

                    jsonAcetoneValue = jsonAcetoneValue.split(":").pop();
                    jsonAcetoneValue = jsonAcetoneValue.replaceAll("\"", "");
                    jsonAcetoneValue = jsonAcetoneValue.replaceAll("}", "");
                    jsonAcetoneValue = jsonAcetoneValue.replaceAll("]", "");

                    if (jsonAcetoneValue <= 100) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#4CBB17";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128516;';
                    }
                    if (jsonAcetoneValue > 100 && jsonAcetoneValue < 250) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#FFA500";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128577;';
                    }
                    if (jsonAcetoneValue > 250 && jsonAcetoneValue <= 500) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#bd1816";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128567;';
                    }
                    if (jsonAcetoneValue > 500) {
                        document.getElementById("acetoneIndicator").style.backgroundColor = "#000000";
                        jsonAcetoneValue = jsonAcetoneValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestAcetone').innerHTML = jsonAcetoneValue;
                    var iterator = acetoneArray.values();

                    var timeArray = [];
                    var acetoneValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanAcetone = JSON.stringify(Object.values(elements));
                        cleanAcetone = cleanAcetone.split(":").pop();
                        cleanAcetone = cleanAcetone.replaceAll("\"", "");
                        cleanAcetone = cleanAcetone.replaceAll("}", "");
                        cleanAcetone = cleanAcetone.replaceAll("]", "");
                        acetoneValueArray.push(cleanAcetone);
                    }

                    if (document.getElementById("acetoneDateArray").value === date) {
                        let temporaryNumberArray = [];
                        let acetoneValueNumberArray = convertStringToNumberArray(acetoneValueArray, temporaryNumberArray);
                        let lowestAcetone, highestAcetone;
                        lowestAcetone = findLowestInArray(acetoneValueNumberArray);
                        highestAcetone = findHighestInArray(acetoneValueNumberArray);
                        let lowestAcetoneCeiling, highestAcetoneCeiling;
                        lowestAcetoneCeiling = Math.round((Math.round(lowestAcetone)) / 10) * 10;
                        highestAcetoneCeiling = Math.round((Math.round(highestAcetone)) / 10) * 10;
                        if (highestAcetoneCeiling === lowestAcetoneCeiling) {
                            highestAcetoneCeiling = highestAcetoneCeiling + 10;
                        }
                        if (highestAcetone > highestAcetoneCeiling) {
                            while (highestAcetone > highestAcetoneCeiling) {
                                highestAcetoneCeiling += 10;
                            }
                        }
                        if (lowestAcetone < lowestAcetoneCeiling) {
                            while (lowestAcetone < lowestAcetoneCeiling) {
                                lowestAcetoneCeiling -= 10;
                            }
                        }

                        document.getElementById("acetoneChartContainer").innerHTML = "";
                        document.getElementById('acetoneChartContainer').innerHTML = "<canvas id=\"acetoneChart\"></canvas>";
                        generateChart("acetoneChart", timeArray, acetoneValueArray, lowestAcetoneCeiling, highestAcetoneCeiling);
                    }
                });

                await RefDHT("MQ2/LPG/", LPGDateSelect, "LPGDateArray");
                firebase.database().ref(currentDayLPG).on('value', (snap) => {
                    var LPGStr = snap.val();
                    var LPGArray = [];
                    Object.keys(LPGStr).forEach((key) => {
                        LPGArray.push({[key]: LPGStr[key]});
                    });

                    var latestLPG = LPGArray[LPGArray.length - 1];
                    var LPGValue = Object.values(latestLPG);
                    var jsonLPGValue = JSON.stringify(LPGValue);

                    jsonLPGValue = jsonLPGValue.split(":").pop();
                    jsonLPGValue = jsonLPGValue.replaceAll("\"", "");
                    jsonLPGValue = jsonLPGValue.replaceAll("}", "");
                    jsonLPGValue = jsonLPGValue.replaceAll("]", "");

                    if (jsonLPGValue <= 500) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#4CBB17";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128516;';
                    }
                    if (jsonLPGValue > 500 && jsonLPGValue <= 1000) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#FFA500";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128577;';
                    }
                    if (jsonLPGValue > 1000 && jsonLPGValue <= 1250) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#bd1816";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128567;';
                    }
                    if (jsonLPGValue > 1250) {
                        document.getElementById("LPGIndicator").style.backgroundColor = "#000000";
                        jsonLPGValue = jsonLPGValue + 'ppm' + '&#128128;';
                    }

                    document.getElementById('latestLPG').innerHTML = jsonLPGValue;
                    var iterator = LPGArray.values();


                    var timeArray = [];
                    var LPGValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanLPG = JSON.stringify(Object.values(elements));
                        cleanLPG = cleanLPG.split(":").pop();
                        cleanLPG = cleanLPG.replaceAll("\"", "");
                        cleanLPG = cleanLPG.replaceAll("}", "");
                        cleanLPG = cleanLPG.replaceAll("]", "");
                        LPGValueArray.push(cleanLPG);
                    }

                    if (document.getElementById("LPGDateArray").value === date) {
                        let temporaryNumberArray = [];
                        let LPGValueNumberArray = convertStringToNumberArray(LPGValueArray, temporaryNumberArray);
                        let lowestLPG, highestLPG;
                        lowestLPG = findLowestInArray(LPGValueNumberArray);
                        highestLPG = findHighestInArray(LPGValueNumberArray);
                        let lowestLPGCeiling, highestLPGCeiling;
                        lowestLPGCeiling = Math.round((Math.round(lowestLPG)) / 10) * 10;
                        highestLPGCeiling = Math.round((Math.round(highestLPG)) / 10) * 10;
                        if (highestLPGCeiling === lowestLPGCeiling) {
                            highestLPGCeiling = highestLPGCeiling + 10;
                        }
                        if (highestLPG > highestLPGCeiling) {
                            while (highestLPG > highestLPGCeiling) {
                                highestLPGCeiling += 10;
                            }
                        }
                        if (lowestLPG < lowestLPGCeiling) {
                            while (lowestLPG < lowestLPGCeiling) {
                                lowestLPGCeiling -= 10;
                            }
                        }

                        document.getElementById("LPGChartContainer").innerHTML = "";
                        document.getElementById('LPGChartContainer').innerHTML = "<canvas id=\"LPGChart\"></canvas>";
                        generateChart("LPGChart", timeArray, LPGValueArray, lowestLPGCeiling, highestLPGCeiling);
                    }
                });

                await RefDHT("MQ2/CO/", CODateSelect, "CODateArray");
                firebase.database().ref(currentDayCO).on('value', (snap) => {
                    var COStr = snap.val();
                    var COArray = [];
                    Object.keys(COStr).forEach((key) => {
                        COArray.push({[key]: COStr[key]});
                    });

                    var latestCO = COArray[COArray.length - 1];
                    var COValue = Object.values(latestCO);
                    var jsonCOValue = JSON.stringify(COValue);

                    jsonCOValue = jsonCOValue.split(":").pop();
                    jsonCOValue = jsonCOValue.replaceAll("\"", "");
                    jsonCOValue = jsonCOValue.replaceAll("}", "");
                    jsonCOValue = jsonCOValue.replaceAll("]", "");

                    if (jsonCOValue <= 6) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128516;';
                        document.getElementById("COIndicator").style.backgroundColor = "#4CBB17";
                    }
                    if (jsonCOValue > 6 && jsonCOValue <= 50) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128577;';
                        document.getElementById("COIndicator").style.backgroundColor = "#FFA500";
                    }
                    if (jsonCOValue > 50 && jsonCOValue <= 200) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128567;';
                        document.getElementById("COIndicator").style.backgroundColor = "#bd1816";
                    }
                    if (jsonCOValue > 200) {
                        jsonCOValue = jsonCOValue + 'ppm' + '&#128128;';
                        document.getElementById("COIndicator").style.backgroundColor = "#000000";
                    }

                    document.getElementById('latestCO').innerHTML = jsonCOValue;
                    var iterator = COArray.values();

                    var timeArray = [];
                    var COValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanCO = JSON.stringify(Object.values(elements));
                        cleanCO = cleanCO.split(":").pop();
                        cleanCO = cleanCO.replaceAll("\"", "");
                        cleanCO = cleanCO.replaceAll("}", "");
                        cleanCO = cleanCO.replaceAll("]", "");
                        COValueArray.push(cleanCO);
                    }

                    if (document.getElementById("CODateArray").value === date) {
                        let temporaryNumberArray = [];
                        let COValueNumberArray = convertStringToNumberArray(COValueArray, temporaryNumberArray);
                        let lowestCO, highestCO;
                        lowestCO = findLowestInArray(COValueNumberArray);
                        highestCO = findHighestInArray(COValueNumberArray);
                        let lowestCOCeiling, highestCOCeiling;
                        lowestCOCeiling = Math.round((Math.round(lowestCO)) / 10) * 10;
                        highestCOCeiling = Math.round((Math.round(highestCO)) / 10) * 10;
                        if (highestCOCeiling === lowestCOCeiling) {
                            highestCOCeiling = highestCOCeiling + 10;
                        }
                        if (highestCO > highestCOCeiling) {
                            while (highestCO > highestCOCeiling) {
                                highestCOCeiling += 10;
                            }
                        }
                        if (lowestCO < lowestCOCeiling) {
                            while (lowestCO < lowestCOCeiling) {
                                lowestCOCeiling -= 10;
                            }
                        }

                        document.getElementById("COChartContainer").innerHTML = "";
                        document.getElementById('COChartContainer').innerHTML = "<canvas id=\"COChart\"></canvas>";
                        generateChart("COChart", timeArray, COValueNumberArray, lowestCOCeiling, highestCOCeiling);
                    }
                });

                await RefDHT("DSM501A/PM25/", PM25DateSelect, "PM25DateArray");
                firebase.database().ref(currentDayPM25).on('value', (snap) => {
                    var PM25Str = snap.val();
                    var PM25Array = [];
                    Object.keys(PM25Str).forEach((key) => {
                        PM25Array.push({[key]: PM25Str[key]});
                    });

                    var latestPM25 = PM25Array[PM25Array.length - 1];
                    var PM25Value = Object.values(latestPM25);
                    var jsonPM25Value = JSON.stringify(PM25Value);

                    jsonPM25Value = jsonPM25Value.split(":").pop();
                    jsonPM25Value = jsonPM25Value.replaceAll("\"", "");
                    jsonPM25Value = jsonPM25Value.replaceAll("}", "");
                    jsonPM25Value = jsonPM25Value.replaceAll("]", "");

                    if (jsonPM25Value <= 12) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128516;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#4CBB17";
                    }
                    if (jsonPM25Value > 12 && jsonPM25Value <= 35) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128577;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#FFA500";
                    }
                    if (jsonPM25Value > 35 && jsonPM25Value <= 55) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128567;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#bd1816";
                    }
                    if (jsonPM25Value > 55) {
                        jsonPM25Value = jsonPM25Value + 'µg/m<sup>3</sup>' + '&#128128;';
                        document.getElementById("PM25Indicator").style.backgroundColor = "#000000";
                    }
                    document.getElementById('latestPM25').innerHTML = jsonPM25Value;

                    var iterator = PM25Array.values();
                    var timeArray = [];
                    var PM25ValueArray = [];
                    for (let elements of iterator) {
                        timeArray.push(Object.keys(elements).toString());
                        let cleanPM25 = JSON.stringify(Object.values(elements));
                        cleanPM25 = cleanPM25.split(":").pop();
                        cleanPM25 = cleanPM25.replaceAll("\"", "");
                        cleanPM25 = cleanPM25.replaceAll("}", "");
                        cleanPM25 = cleanPM25.replaceAll("]", "");
                        PM25ValueArray.push(cleanPM25);
                    }

                    if (document.getElementById("PM25DateArray").value === date) {
                        let temporaryNumberArray = [];
                        let PM25ValueNumberArray = convertStringToNumberArray(PM25ValueArray, temporaryNumberArray);
                        let lowestPM25, highestPM25;
                        lowestPM25 = findLowestInArray(PM25ValueNumberArray);
                        highestPM25 = findHighestInArray(PM25ValueNumberArray);
                        let lowestPM25Ceiling, highestPM25Ceiling;
                        lowestPM25Ceiling = Math.round((Math.round(lowestPM25)) / 10) * 10;
                        highestPM25Ceiling = Math.round((Math.round(highestPM25)) / 10) * 10;
                        if (highestPM25Ceiling === lowestPM25Ceiling) {
                            highestPM25Ceiling = highestPM25Ceiling + 10;
                        }
                        if (highestPM25 > highestPM25Ceiling) {
                            while (highestPM25 > highestPM25Ceiling) {
                                highestPM25Ceiling += 10;
                            }
                        }
                        if (lowestPM25 < lowestPM25Ceiling) {
                            while (lowestPM25 < lowestPM25Ceiling) {
                                lowestPM25Ceiling -= 10;
                            }
                        }

                        document.getElementById("PM25ChartContainer").innerHTML = "";
                        document.getElementById('PM25ChartContainer').innerHTML = "<canvas id=\"PM25Chart\"></canvas>";
                        generateChart("PM25Chart", timeArray, PM25ValueNumberArray, lowestPM25Ceiling, highestPM25Ceiling);
                    }
                });

            }
        );
    </script>
</div>
</body>

</html>



